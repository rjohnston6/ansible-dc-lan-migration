{#
================================================================================
Template: Feature Policy Bulk Create (JSON Payload)
================================================================================
Purpose:
  Generate JSON payload for the NDFC REST API to create feature policies
  for a switch via bulk-create endpoint.

API Endpoint:
  POST /appcenter/cisco/ndfc/api/v1/lan-fabric/rest/control/policies/bulk-create

Input Variables:
  serial_number              - Target switch serial number
  template_name              - NDFC policy template name (from feature_lookup)

Key Settings:
  entityName: SWITCH         - Policy applies to a switch
  entityType: SWITCH         - Entity type
  priority: 500              - Policy priority

Notes:
  - Each feature requires a separate API call
  - Template names are mapped via 1.2-provision-features-feature_lookup.yml
  - Only features with valid template mappings will be configured
  - Features that do not have a dedicated NDFC policy template are deployed
    using the switch_freeform template, which accepts arbitrary NX-OS CLI
    via the nvPairs.CONF field. This allows any feature to be enabled even
    when no specific NDFC template exists.

  Freeform policy conventions (when templateName == 'switch_freeform'):
    - nvPairs.CONF : Raw NX-OS CLI to push to the switch.
                     Constructed as: "feature <nxos_feature_name>"
                     e.g. "feature hsrp", "feature udld", "feature bash-shell"
    - description  : Used as a unique idempotency key since all freeform
                     policies share the same templateName. Constructed as:
                     "feature_<nxos_feature_name>"
                     e.g. "feature_hsrp", "feature_udld", "feature_bash-shell"
                     The idempotency check in the playbook matches on
                     "switch_freeform:<description>" to detect existing policies.
================================================================================
#}
{
  "nvPairs": {% if template_name == 'switch_freeform' %}{"CONF": "feature {{ feature }}"}{% else %}{}{% endif %},
  "entityName": "SWITCH",
  "entityType": "SWITCH",
  "source": "",
  "priority": 500,
  "description": "{% if template_name == 'switch_freeform' %}feature_{{ feature }}{% endif %}",
  "templateName": "{{ template_name }}",
  "serialNumber": "{{ serial_number }}"
}
