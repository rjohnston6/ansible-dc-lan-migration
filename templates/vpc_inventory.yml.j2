#==============================================================================
# Template: VPC Interface Inventory Generator
#==============================================================================
# Purpose: Generate consolidated VPC interface inventory from profiled data
#
# Input Variables:
#   - fabric_name: Name of the fabric
#   - fabric_vpc_interfaces: List of VPC interfaces consolidated by vpc_id
#
# VPC Consolidation:
#   VPC interfaces with the same vpc_id on different switches are consolidated
#   into a single entry spanning both switches. This represents the dual-homed
#   nature of VPC interfaces.
#
# Structure:
#   vpc_interfaces: List of consolidated VPCs
#     Each VPC includes:
#       - name: Port-channel interface name
#       - vpc_id: VPC identifier (same on both switches)
#       - switches: List of VPC peer switches [peer1, peer2]
#       - members: Dictionary mapping switch names to member interface lists
#       - mode: trunk or access
#       - VLAN configuration (trunk/access specific)
#       - description: Interface description
#==============================================================================

# VPC Interface Inventory for Fabric: {{ fabric_name }}
# Generated by Ansible automation
# VPCs are consolidated across switch pairs

vpc_interfaces:
{% for vpc in fabric_vpc_interfaces %}
  - name: {{ vpc.name }}
    type: {{ vpc.type }}
    vpc_id: {{ vpc.vpc_id }}
    switches:
{% for switch in vpc.switches %}
      - {{ switch }}
{% endfor %}
{% if vpc.mode is defined %}
    mode: {{ vpc.mode }}
{% endif %}
{% if vpc.trunk is defined and vpc.trunk | length > 0 %}
    trunk:
{% if vpc.trunk.allowed_vlans is defined %}
      allowed_vlans: {{ vpc.trunk.allowed_vlans }}
{% endif %}
{% if vpc.trunk.native_vlan is defined %}
      native_vlan: {{ vpc.trunk.native_vlan }}
{% endif %}
{% endif %}
{% if vpc.access is defined and vpc.access.vlan is defined %}
    access:
      vlan: {{ vpc.access.vlan }}
{% endif %}
{% if vpc.description is defined %}
    description: "{{ vpc.description }}"
{% endif %}
    members:
{% for switch_name, member_list in vpc.members.items() %}
      {{ switch_name }}:
{% for member in member_list %}
        - interface: {{ member.member | default(member.interface) }}
{% if member.mode is defined %}
          mode: {{ member.mode }}
{% endif %}
{% endfor %}
{% endfor %}
{% endfor %}
