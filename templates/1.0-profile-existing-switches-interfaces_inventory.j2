#==============================================================================
# Template: Interface Inventory Generator
#==============================================================================
# Purpose: Generate human-readable YAML inventory files from profiled
#          interface configurations
#
# Input Variables:
#   - fabric_name: Name of the fabric
#   - fabric_interfaces: Dictionary of switch interfaces grouped by switch
#     Structure: {switch_name: {interfaces: [...]}}
#
# Output: YAML file with interface configurations organized by switch
#
# Interface Types Supported:
#   - eth: Physical Ethernet interfaces
#   - svi: VLAN interfaces (Switched Virtual Interfaces)
#   - lo: Loopback interfaces
#   - pc: Port-channel interfaces
#   - vpc: Virtual Port Channel interfaces
#
# Configuration Data Included:
#   - Interface type and mode (access, trunk, routed, vlan, lo)
#   - IP addressing (IPv4/IPv6)
#   - VLAN assignments (trunk allowed VLANs, access VLAN, native VLAN)
#   - HSRP configurations
#   - OSPF configurations
#   - DHCP relay servers
#   - Port-channel members
#   - Interface descriptions (quoted for special characters)
#==============================================================================

# Interface Inventory for Fabric: {{ fabric_name }}
# Generated by Ansible automation

switches:
{% for switch_name, switch_data in fabric_interfaces.items() %}
  {{ switch_name }}:
    interfaces:
{% for interface in switch_data.interfaces %}
      - name: {{ interface.name | default(interface.interface) }}
        type: {{ interface.type }}
{% if interface.state is defined %}
        state: {{ interface.state }}
{% endif %}
{% if interface.mode is defined %}
        mode: {{ interface.mode }}
{% elif interface.ipv4_address is defined %}
{% if interface.type == 'svi' %}
        mode: vlan
{% elif interface.type == 'lo' %}
        mode: lo
{% else %}
        mode: routed
{% endif %}
{% elif interface.access is defined %}
        mode: access
{% endif %}
{% if interface.enabled is defined %}
        enabled: {{ interface.enabled }}
{% endif %}
{% if interface.ipv4_address is defined %}
        ipv4_address: {{ interface.ipv4_address }}
{% endif %}
{% if interface.ipv4_redirects is defined %}
        ipv4_redirects: {{ interface.ipv4_redirects }}
{% endif %}
{% if interface.ipv6_address is defined %}
        ipv6_address: {{ interface.ipv6_address }}
{% endif %}
{% if interface.ipv6_redirects is defined %}
        ipv6_redirects: {{ interface.ipv6_redirects }}
{% endif %}
{% if interface.description is defined %}
        description: "{{ interface.description }}"
{% endif %}
{% if interface.dhcp_server_add1 is defined %}
        dhcp_relay:
{% if interface.dhcp_server_add1 is defined %}
          - {{ interface.dhcp_server_add1 }}
{% endif %}
{% if interface.dhcp_server_add2 is defined %}
          - {{ interface.dhcp_server_add2 }}
{% endif %}
{% if interface.dhcp_server_add3 is defined %}
          - {{ interface.dhcp_server_add3 }}
{% endif %}
{% endif %}
{% if interface.hsrp_group is defined %}
        hsrp:
          group: {{ interface.hsrp_group }}
          version: {{ interface.hsrp_version }}
          virtual_ip: {{ interface.hsrp_virtual_ip }}
{% if interface.hsrp_priority is defined %}
          priority: {{ interface.hsrp_priority }}
{% endif %}
{% if interface.hsrp_preempt is defined and interface.hsrp_preempt %}
          preempt: true
{% endif %}
{% if interface.hsrp_hello_interval is defined %}
          timers:
            hello_interval: {{ interface.hsrp_hello_interval }}
            hold_time: {{ interface.hsrp_hold_time }}
{% if interface.hsrp_timers_msec is defined and interface.hsrp_timers_msec %}
            msec: true
{% endif %}
{% endif %}
{% endif %}
{% if interface.ospf_area is defined %}
        ospf:
          area: {{ interface.ospf_area }}
          process: {{ interface.ospf_process }}
{% endif %}
{% if interface.trunk is defined and (interface.trunk.allowed_vlans is defined or interface.trunk.native_vlan is defined) %}
        trunk:
{% if interface.trunk.allowed_vlans is defined %}
          allowed_vlans: {{ interface.trunk.allowed_vlans }}
{% endif %}
{% if interface.trunk.native_vlan is defined %}
          native_vlan: {{ interface.trunk.native_vlan }}
{% endif %}
{% endif %}
{% if interface.access is defined %}
        access:
          vlan: {{ interface.access.vlan }}
{% endif %}
{% if interface.vpc_id is defined %}
        vpc_id: {{ interface.vpc_id }}
{% endif %}
{% if interface.members is defined %}
        members:
{% for member in interface.members %}
          - interface: {{ member.member }}
            mode: {{ member.mode }}
{% endfor %}
{% endif %}
{% if interface.cdp_enable is defined %}
        cdp_enable: {{ interface.cdp_enable }}
{% endif %}
{% endfor %}

{% endfor %}
