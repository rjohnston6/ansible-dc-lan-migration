{#
================================================================================
Template: Port-Channel Interface Configuration (JSON Payload)
================================================================================
Purpose:
  Generate JSON payload for the NDFC REST API to configure port-channel
  interfaces for uplink connectivity.

API Endpoint:
  POST /appcenter/cisco/ndfc/api/v1/lan-fabric/rest/globalInterface

Input Variables:
  serial_number              - Target switch serial number
  fabric_name                - Fabric name
  port_channel_name          - Port-channel name (e.g., Port-channel113)
  member_interfaces          - Comma-separated member interfaces (e.g., Ethernet1/1,Ethernet1/2)
  pc_mode                    - Port-channel mode (active, passive, on)
  allowed_vlans              - Trunk allowed VLANs (e.g., 101-199)
  native_vlan                - Native VLAN ID
  description                - Interface description

Key Settings:
  policy: int_port_channel_trunk_host - Trunk port-channel policy
  interfaceType: INTERFACE_PORT_CHANNEL - Port-channel interface
  skipResourceCheck: false   - Validate resource availability

Notes:
  - Configures port-channel interfaces as trunk ports for uplinks
  - Member interfaces must be configured first (via 1.2 playbook)
  - PC_MODE typically "active" for LACP
================================================================================
#}
{
  "policy": "int_port_channel_trunk_host",
  "interfaceType": "INTERFACE_PORT_CHANNEL",
  "interfaces": [
    {
      "serialNumber": "{{ serial_number }}",
      "interfaceType": "INTERFACE_PORT_CHANNEL",
      "fabricName": "{{ fabric_name }}",
      "ifName": "{{ port_channel_name | regex_replace('^port-channel', 'Port-channel') }}",
      "nvPairs": {
        "MEMBER_INTERFACES": "{{ member_interfaces }}",
        "PC_MODE": "{{ pc_mode | default('active') }}",
        "BPDUGUARD_ENABLED": "no",
        "BPDUFILTER_ENABLED": "no",
        "LINK_TYPE": "auto",
        "PORTTYPE_FAST_ENABLED": "true",
        "MTU": "default",
        "SPEED": "Auto",
        "ALLOWED_VLANS": "{{ allowed_vlans | default('none') }}",
        "NATIVE_VLAN": "{{ native_vlan | default('') }}",
        "DESC": "{{ description | default('') }}",
        "COPY_DESC": "false",
        "NEGOTIATE_AUTO": "true",
        "CDP_ENABLE": "true",
        "ENABLE_ORPHAN_PORT": "false",
        "PORT_DUPLEX_MODE": "auto",
        "BANDWIDTH": "",
        "INHERIT_BW": "",
        "DISABLE_LACP_SUSPEND": "false",
        "LACP_PORT_PRIO": "32768",
        "LACP_RATE": "normal",
        "CONF": "",
        "ADMIN_STATE": "true",
        "ENABLE_NETFLOW": "false",
        "NETFLOW_MONITOR": "",
        "NETFLOW_SAMPLER": "",
        "ENABLE_PFC": "false",
        "ENABLE_QOS": "false",
        "QOS_POLICY": "",
        "QUEUING_POLICY": "",
        "ENABLE_MONITOR": "false",
        "enableVlanMapping": "false",
        "vlanMappingEntries": "",
        "ENABLE_STORM_CONTROL": "false",
        "STORM_CONTROL_ACTION": "",
        "STORM_CONTROL_BCAST_LEVEL_PERCENT": "",
        "STORM_CONTROL_MCAST_LEVEL_PERCENT": "",
        "STORM_CONTROL_UCAST_LEVEL_PERCENT": "",
        "STORM_CONTROL_BCAST_LEVEL_PPS": "",
        "STORM_CONTROL_MCAST_LEVEL_PPS": "",
        "STORM_CONTROL_UCAST_LEVEL_PPS": "",
        "PO_ID": "{{ port_channel_name | regex_replace('^port-channel', 'Port-channel') }}"
      }
    }
  ],
  "skipResourceCheck": false
}
