{#
================================================================================
Template: Add Switches to Nexus Dashboard Fabric (JSON Payload)
================================================================================
Purpose:
  Generate JSON payload for the Nexus Dashboard REST API to register/onboard
  brownfield switches to a fabric while preserving their existing configurations.

API Endpoint:
  POST /api/v1/manage/fabrics/{fabric_name}/switches

Input Variables:
  item.switches              - List of switch objects to add
  item.switches[].hostname   - Switch hostname
  item.switches[].ip_address - Switch management IP
  item.switches[].serial_number - Switch serial number
  item.switches[].model      - Switch model (e.g., N9K-C9300v)
  item.switches[].role       - Switch role (e.g., leaf, spine, border)
  item.switches[].sw_version - NX-OS software version
  nd_switch_username         - SSH/SNMP username for switch access
  nd_switch_password         - SSH/SNMP password for switch access

Key Settings:
  preserveConfig: true       - Keep existing switch configuration
  platformType: nx-os        - Cisco NX-OS operating system
  useCredentialForWrite: true - Use provided credentials for config writes

Notes:
  - This template is used for brownfield migration scenarios
  - Preserving config prevents disruption to existing services
  - Switches must be reachable via management network
  - Credentials must have sufficient privileges on the switches
================================================================================
#}
 {
    "password": "{{ nd_switch_password }}",      {# Switch access password #}
    "platformType": "nx-os",                      {# Target platform type #}
    "preserveConfig": true,                       {# Keep existing config #}
    "snmpV3AuthProtocol": "md5",                  {# SNMPv3 auth protocol #}
    "switches": [                                 {# Array of switches to add #}
{% for switch in item.switches %}                 {# Loop through switches #}
        {
            "hostname": "{{ switch.hostname }}",       {# Switch hostname #}
            "ip": "{{ switch.ip_address }}",          {# Management IP #}
            "serialNumber": "{{ switch.serial_number }}",  {# Serial number #}
            "model": "{{ switch.model }}",             {# Hardware model #}
            "switchRole": "{{ switch.role }}",         {# Role in fabric #}
            "softwareVersion": "{{ switch.sw_version }}"  {# NX-OS version #}
        }{% if not loop.last %},{% endif %}          {# Comma between items #}
{% endfor %}
    ],
    "useCredentialForWrite": true,               {# Use creds for writes #}
    "username": "{{ nd_switch_username }}"       {# Switch access username #}
}